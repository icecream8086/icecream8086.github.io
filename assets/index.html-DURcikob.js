import{_ as i,c as a,b as e,o as n}from"./app-CHEI8h4L.js";const l={};function h(t,s){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>使用 Podman 部署 MySQL 容器，并通过 <code>podman exec</code> 执行 SQL 命令创建用户</p><p>避免Mysql版本问题造成困扰,可以实现多开，还避免了暴毙的可能性，忘了密码直接 <code>podman exec</code> 重置，因为环境变量里有root密码，假设不做修改，开发的时候这么干很方便</p><h2 id="步骤-1-拉取-mysql-镜像" tabindex="-1"><a class="header-anchor" href="#步骤-1-拉取-mysql-镜像"><span>步骤 1: 拉取 MySQL 镜像</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">podman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pull</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="步骤-2-准备环境变量和目录" tabindex="-1"><a class="header-anchor" href="#步骤-2-准备环境变量和目录"><span>步骤 2: 准备环境变量和目录</span></a></h2><h3 id="创建数据目录-纯开发可以省略此步骤" tabindex="-1"><a class="header-anchor" href="#创建数据目录-纯开发可以省略此步骤"><span>创建数据目录(纯开发可以省略此步骤)</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/mysql/data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/mysql/conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置-selinux-策略-重要" tabindex="-1"><a class="header-anchor" href="#设置-selinux-策略-重要"><span>设置 SELinux 策略（重要）</span></a></h3><p>使用 <code>:Z</code> 标志让 Podman 自动管理 SELinux 标签：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在卷挂载时使用 :Z 标志</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/mysql/data:/var/lib/mysql:Z</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="步骤-3-运行-mysql-容器" tabindex="-1"><a class="header-anchor" href="#步骤-3-运行-mysql-容器"><span>步骤 3: 运行 MySQL 容器</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">podman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-server</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3306:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/mysql/data:/var/lib/mysql:Z</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/mysql/conf:/etc/mysql/conf.d:Z</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>参数说明：</strong></p><ul><li><code>-d</code>: 后台运行</li><li><code>--name mysql-server</code>: 容器名称</li><li><code>-e MYSQL_ROOT_PASSWORD</code>: 设置 root 用户密码</li><li><code>-p 3306:3306</code>: 端口映射（主机端口:容器端口）</li><li><code>-v ~/mysql/data:/var/lib/mysql:Z</code>: 数据目录映射，<code>:Z</code> 用于 SELinux</li><li><code>-v ~/mysql/conf:/etc/mysql/conf.d:Z</code>: 配置文件目录映射</li></ul><h2 id="步骤-4-等待-mysql-启动" tabindex="-1"><a class="header-anchor" href="#步骤-4-等待-mysql-启动"><span>步骤 4: 等待 MySQL 启动</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查容器状态</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">podman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看日志确认 MySQL 已启动</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">podman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> logs</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-server</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>等待在日志中看到 &quot;MySQL init process done. Ready for start up&quot; 或类似消息。</p><h2 id="步骤-5-执行-sql-命令创建用户-默认root无法远程登录" tabindex="-1"><a class="header-anchor" href="#步骤-5-执行-sql-命令创建用户-默认root无法远程登录"><span>步骤 5: 执行 SQL 命令创建用户(默认root无法远程登录)</span></a></h2><h3 id="方法-1-使用-podman-exec-直接执行" tabindex="-1"><a class="header-anchor" href="#方法-1-使用-podman-exec-直接执行"><span>方法 1: 使用 podman exec 直接执行</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">podman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -pMYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> EOF</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">CREATE USER &#39;user_galen&#39;@&#39;%&#39; IDENTIFIED BY &#39;MYSQL_ROOT_PASSWORD&#39;;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">GRANT ALL PRIVILEGES ON *.* TO &#39;user_galen&#39;@&#39;%&#39;;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">FLUSH PRIVILEGES;</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="方法-2-进入容器交互式执行" tabindex="-1"><a class="header-anchor" href="#方法-2-进入容器交互式执行"><span>方法 2: 进入容器交互式执行</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">podman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在 MySQL 提示符下执行：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">CREATE</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> USER</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user_galen</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> IDENTIFIED</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> BY</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">GRANT</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ALL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PRIVILEGES</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ON</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TO</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user_galen</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">FLUSH</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PRIVILEGES</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">exit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="步骤-6-验证用户创建" tabindex="-1"><a class="header-anchor" href="#步骤-6-验证用户创建"><span>步骤 6: 验证用户创建</span></a></h2><p>重复步骤5登录，登录用户换成<code>user_galen</code></p><h2 id="重要提醒" tabindex="-1"><a class="header-anchor" href="#重要提醒"><span>重要提醒</span></a></h2><h3 id="_1-selinux-策略" tabindex="-1"><a class="header-anchor" href="#_1-selinux-策略"><span>1. SELinux 策略</span></a></h3><ul><li>使用 <code>:Z</code> 或 <code>:z</code> 标志来正确处理 SELinux 上下文</li><li><code>:Z</code>: 私有非共享标签</li><li><code>:z</code>: 共享标签</li></ul><h2 id="碎碎念部分" tabindex="-1"><a class="header-anchor" href="#碎碎念部分"><span>碎碎念部分</span></a></h2><p>Podman 在此架构中，本质上是一个系统调用拦截与命名空间管理中间件。它通过 <code>runC</code> 之类的底层工具，在宿主机内核上为你申请的 MySQL 进程套上了一层进程沙箱。</p><p>成也沙箱，败也沙箱，当 MySQL 在容器内执行一个看似简单的 <code>write()</code> 系统调用将数据刷盘时，这个调用会先被 Podman 虚拟化的文件系统命名空间和存储驱动（如 overlayfs）处理一次，再映射到宿主机的实际存储路径。这层转换带来了便利，但也引入了额外的调用链和复杂性。数据库进程不再直接与内核对话，进程依赖关系也因此变得<strong>脆弱且不透明</strong>。在传统部署中，MySQL 以 systemd 服务运行时，其依赖关系是清晰、声明式的。</p><p>而在 容器 模式下，数据库进程成了 Podman 子进程的一个“孙进程”。这种隐含的依赖关系非常致命：任何 Podman 自身的问题、其依赖的 <code>conmon</code> 监控进程的异常、甚至只是终端会话的意外信号，都可能瞬间切断整个调用链，导致数据库进程被牵连而暴毙。此时数据库服务直接翘辫子了</p><blockquote><p>简单地用联合概率可以看出来</p></blockquote><p>在传统部署中，两者近乎独立$$ P(B|A) \\approx P(B) $$，即系统服务管理器（如 systemd）的异常几乎不影响 MySQL。</p><p>容器化部署下，MySQL 作为 Podman 的子孙进程，存在强依赖：$$ P(B|A) \\approx 1 $$。因此，服务不可用的联合概率 $$ P(A \\cap B) = P(A) \\cdot P(B|A) \\approx P(A) $$</p><p><s>结论非常明确：开发环境图个方便绰绰有余，podman进程任意挂掉一个数据库跟着倒霉，不适用于生产环境</s></p>`,36)])])}const p=i(l,[["render",h]]),k=JSON.parse(`{"path":"/article/tmr2sixm/","title":"如何用podman部署mysql用于开发","lang":"zh-CN","frontmatter":{"title":"如何用podman部署mysql用于开发","createTime":"2025/11/04 00:51:34","permalink":"/article/tmr2sixm/","description":"概述 使用 Podman 部署 MySQL 容器，并通过 podman exec 执行 SQL 命令创建用户 避免Mysql版本问题造成困扰,可以实现多开，还避免了暴毙的可能性，忘了密码直接 podman exec 重置，因为环境变量里有root密码，假设不做修改，开发的时候这么干很方便 步骤 1: 拉取 MySQL 镜像 步骤 2: 准备环境变量和目...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"如何用podman部署mysql用于开发\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-11-03T17:21:51.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://www.hexgrid.ink/article/tmr2sixm/"}],["meta",{"property":"og:site_name","content":"icecream8086's blog"}],["meta",{"property":"og:title","content":"如何用podman部署mysql用于开发"}],["meta",{"property":"og:description","content":"概述 使用 Podman 部署 MySQL 容器，并通过 podman exec 执行 SQL 命令创建用户 避免Mysql版本问题造成困扰,可以实现多开，还避免了暴毙的可能性，忘了密码直接 podman exec 重置，因为环境变量里有root密码，假设不做修改，开发的时候这么干很方便 步骤 1: 拉取 MySQL 镜像 步骤 2: 准备环境变量和目..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-03T17:21:51.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-03T17:21:51.000Z"}]]},"readingTime":{"minutes":3.31,"words":992},"git":{"createdTime":1762190511000,"updatedTime":1762190511000,"contributors":[{"name":"LinLai","username":"LinLai","email":"zzbsn.cn@outlook.com","commits":1,"avatar":"https://avatars.githubusercontent.com/LinLai?v=4","url":"https://github.com/LinLai"}]},"autoDesc":true,"filePathRelative":"preview/deploy_mysql.md","headers":[],"categoryList":[{"id":"5ebeb6","sort":10000,"name":"preview"}]}`);export{p as comp,k as data};
